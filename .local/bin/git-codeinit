#!/bin/bash

default_domain="github.com"
default_user="rilstrats"

input=$1
[[ -z $input ]] && read -p "Please enter repo location: " input
[[ -z $input ]] && echo "Exit: No input supplied" && exit


matches=($(echo $input | grep -oP '([^\/]*[^\/])'))

if [[ ${#matches[@]} -eq 0 ]]; then
    echo "Error: failed to find any matches"
    exit 1
elif [[ ${#matches[@]} -le 3 ]]; then
    # quiet stupid bash warnings
    exec 3>&2
    exec 2>/dev/null
    domain=${matches[-3]:-$default_domain}
    user=${matches[-2]:-$default_user}
    repo=${matches[-1]}
    # restore bash warnings for rest of script
    exec 2>&3
    exec 3>&-
    rel_path=$domain/$user/$repo
else
    rel_path=""
    for match in ${matches[@]}; do
        rel_path+=$match/
    done
    rel_path=${rel_path::-1}
fi

abs_path="$CODEPATH/$rel_path"

read -p "Is $abs_path correct? [y/N]: " input
proceed=$(echo ${input:0:1} | tr '[:upper:]' '[:lower:]')

[[ $proceed != 'y' ]] && echo "Exit: please make manually!" && exit

[[ -d $abs_path ]] && echo "Exit: repository already exists" && exit

mkdir -p $abs_path
git init $abs_path
